---
title: "Practica Final Parte 1"
author: "Xavier Vives, Josep Damià Ruiz, Antonio Marin y Martí Paredes"
output:
  pdf_document: default
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
  word_document: default
  html_document:
    df_print: paged
---

\tableofcontents 
\newpage

## **1. Cargad en un dataframe los datos del fichero listings.csv y construid un nuevo data frame**

```{r 1}
datos_raw = read.csv("listings.csv")
datos = datos_raw[-c(1,2,3,5,14,15)]
```

## **2. Renombrar las variables al castellano.**

```{r 2}
names(datos)[names(datos) == "host_name"] <- "Nombre_propietario"
names(datos)[names(datos) == "neighbourhood"] <- "Vecindario"
names(datos)[names(datos) == "latitude"] <- "Lat."
names(datos)[names(datos) == "longitude"] <- "Long."
names(datos)[names(datos) == "room_type"] <- "Tipo_habitación"
names(datos)[names(datos) == "price"] <- "Precio"
names(datos)[names(datos) == "minimum_nights"] <- "Min.noches"
names(datos)[names(datos) == "number_of_reviews"] <- "N_reseñas"
names(datos)[names(datos) == "number_of_reviews_ltm"] <- "Reseñas_mes"
names(datos)[names(datos) == "availability_365"] <- "Disponibilidad_año"

datos<- subset(datos, datos$Precio<1000)
datos<- subset(datos, datos$Min.noches<400)

names(datos)

```

## **3. Calcular mínimo, máximo, media, varianza, cuartiles y mediana.**

```{r 3}
media = unname(sapply(datos[c(3,4,6,7,8,9)],FUN=mean))
varianza = unname(sapply(datos[c(3,4,6,7,8,9)],FUN=var))
cuartiles = sapply(datos[c(3,4,6,7,8,9)],FUN=quantile)
rownames(cuartiles)<-(c("mínimo","Cuartil_1","Mediana","Cuartil_3","màximo"))
datosEstadisticos=media
datosEstadisticos<-rbind(datosEstadisticos, media)
datosEstadisticos<-rbind(datosEstadisticos, varianza)
datosEstadisticos<-rbind(datosEstadisticos,cuartiles)
datosEstadisticos<-round(datosEstadisticos, digits=4)
datosEstadisticos
```

## **4. Tablas de frecuencias absolutas.**

```{r 4}
frecuenciaVecinador = table(datos$Vecindario)
frecuenciaNombre = table(datos$Nombre_propietario)
frecuenciaNombre <- subset(frecuenciaNombre,frecuenciaNombre > 20)
frecuenciaNombre = sort(frecuenciaNombre, decreasing = TRUE)
frecuenciaTipo = table(datos$Tipo_habitación)
frecuenciaVecinador
frecuenciaNombre
frecuenciaTipo
```

## **5. Boxplots y histogramas.**

```{r 5}
boxplot(datos$Lat.)
hist(datos$Lat., main= "Histograma de la variable Latitud", xlab = "Latitud")
boxplot(datos$Long.)
hist(datos$Long., main= "Histograma de la variable Longitud", xlab = "Longitud")
boxplot(datos$Precio)
L1 = c(0,100,250,1000,2500,5000,10000)
hist(datos$Precio, main= "Histograma de la variable Precio")
boxplot(datos$Min.noches)
hist(datos$Min.noches, main= "Histograma de la variable Minimo de noches", xlab = "Minimo de noches")
boxplot(datos$N_reseñas)
hist(datos$N_reseñas, main= "Histograma de la variable Numero de reseñas", xlab = "Numero de reseñas")
boxplot(datos$Reseñas_mes)
hist(datos$Reseñas_mes, main= "Histograma de la variable Numero de reseñas por mes", xlab = "Numero de reseñas por mes", xlim = c(0,35))
boxplot(datos$Disponibilidad_año)
hist(datos$Disponibilidad_año, main= "Histograma de la variable disponibilidad por año", xlab = "Disponibilidad por año")
```


## **Pie chart de variables no numéricas**
```{r 6}

frecuenciaVecindario = table(datos$Vecindario) #Hacemos una tabla de la frecuencias de la cantidad de habitaciones que hay para cada barrio
habitacionesTotal=max(cumsum(frecuenciaVecindario)) #Número total de habitaciones en Malta

frecuenciaVecindario <- frecuenciaVecindario[frecuenciaVecindario>0.01*habitacionesTotal] #Excluimos las ciudades que no representan ni un 1% del total

numeroDeOtros= habitacionesTotal-max(cumsum(frecuenciaVecindario)) #Conseguir el número de "Otros" que hay en total

names(numeroDeOtros)="Otros"
frecuenciaVecindario=append(frecuenciaVecindario, numeroDeOtros) #Añadir Otros al final de la tabla

pie(frecuenciaVecindario, main="Diagrama de tarta de la cantidad de habitaciones por cada barrio") #Graficarlo








```

## **9. Diagramas de dispersión de 4 variables numéricas 2 a 2, con un color para cada Vecindario.**
```{r 9}



VecindarioNum <-as.factor(datos$Vecindario) # Pasamos el vector vecindario a un vector de factores



datos$Min.noches <- ifelse(datos$Min.noches > 200, 200, datos$Min.noches) #creamos el primer plot
plot(
  x = datos$Precio,
  y = datos$Min.noches,
  xlab = "Precio",
  ylab = "Minimo noches",
  pch = 20, # solid dots increase the readability of this data plot
  col = VecindarioNum, # El color se asigna dependiendo del vecindario
  main = "Precio /Min noches"
)
plot(
  x = datos$N_reseñas,
  y = datos$Reseñas_mes,
  xlab = "Numero Reseñas",
  ylab = "Reseñas/mes",
  pch = 20, # solid dots increase the readability of this data plot
  col = VecindarioNum, # El color se asigna dependiendo del vecindario
  main = "N_Reseñas /Reseñas_Mes"
)










```


## **10. Coeficientes de correlación 2 a 2 apartado anterior.**
```{r 10}
cor(x = datos$Precio, y = datos$Min.noches)
cor(x = datos$N_reseñas, y = datos$Reseñas_mes)
```

## **11. Con 2 variables numéricas, organizar sus valores en un máximo de 5 intervalos con ala función cut.**
```{r 11,results='hide'}
Cut1 <- cut(x = datos$Precio, breaks = 5)
Cut2 <- cut(x = datos$N_reseñas, breaks = 5)
```

## **12. Con 2 variables numéricas, organizar sus valores en un máximo de 5 intervalos con ala función cut.**
```{r 12}

tabla_prop <- prop.table(Cut1)
barplot(tabla_prop)

```